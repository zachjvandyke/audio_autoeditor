{% extends "base.html" %}
{% block title %}Dashboard - Audio AutoEditor{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>Projects</h1>
        <a href="{{ url_for('project.new') }}" class="btn btn-primary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            New Project
        </a>
    </div>

    <div class="dashboard-controls">
        <form class="search-form" method="GET" action="{{ url_for('dashboard.index') }}">
            <div class="search-input-wrap">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                </svg>
                <input type="text" name="q" value="{{ search }}" placeholder="Search projects..." class="search-input">
            </div>
            <select name="sort" class="sort-select" onchange="this.form.submit()">
                <option value="updated" {{ 'selected' if sort == 'updated' }}>Last Updated</option>
                <option value="created" {{ 'selected' if sort == 'created' }}>Date Created</option>
                <option value="title" {{ 'selected' if sort == 'title' }}>Title</option>
                <option value="status" {{ 'selected' if sort == 'status' }}>Status</option>
            </select>
        </form>
    </div>

    {% if projects %}
    <div class="project-grid">
        {% for project in projects %}
        <div class="project-card" data-project-id="{{ project.id }}">
            <div class="project-card-header">
                <h3 class="project-title">{{ project.title }}</h3>
                <span class="status-badge status-{{ project.status }}">{{ project.status }}</span>
            </div>

            <div class="project-card-body">
                <div class="project-meta">
                    <span class="meta-item">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        {{ project.audio_files|length }} audio file{{ 's' if project.audio_files|length != 1 }}
                    </span>
                    <span class="meta-item">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        {{ project.created_at.strftime('%b %d, %Y') if project.created_at }}
                    </span>
                </div>

                {% set stats = project.conflict_stats %}
                {% if stats.total > 0 %}
                <div class="conflict-summary">
                    <div class="conflict-bar">
                        <div class="conflict-bar-fill" style="width: {{ (stats.resolved / stats.total * 100) if stats.total else 0 }}%"></div>
                    </div>
                    <span class="conflict-text">{{ stats.resolved }}/{{ stats.total }} resolved</span>
                </div>
                {% endif %}
            </div>

            <div class="project-card-actions">
                {% if project.status in ('ready', 'exported') %}
                <a href="{{ url_for('editor.edit', project_id=project.id) }}" class="btn btn-secondary btn-sm">Open Editor</a>
                <a href="{{ url_for('editor.export', project_id=project.id) }}" class="btn btn-outline btn-sm">Export RPP</a>
                {% elif project.status == 'processing' %}
                <span class="processing-indicator">
                    <span class="spinner"></span> Processing...
                </span>
                {% else %}
                <a href="{{ url_for('editor.edit', project_id=project.id) }}" class="btn btn-secondary btn-sm">View</a>
                {% endif %}
                <form method="POST" action="{{ url_for('project.delete', project_id=project.id) }}"
                      onsubmit="return confirm('Delete this project?')" class="inline-form">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.4">
            <path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/>
        </svg>
        <h2>No projects yet</h2>
        <p>Create your first audiobook editing project to get started.</p>
        <a href="{{ url_for('project.new') }}" class="btn btn-primary">Create Project</a>
    </div>
    {% endif %}
</div>

<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
